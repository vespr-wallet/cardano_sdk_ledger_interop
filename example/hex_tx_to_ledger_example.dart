// ignore_for_file: non_constant_identifier_names, unreachable_from_main, avoid_print

import "package:cardano_dart_types/cardano_dart_types.dart";
import "package:cardano_sdk_ledger_interop/src/mapper.dart";

extension AddrExt on CardanoAddress {
  CardanoAddress withPaymentCredentials(List<int> newCredentials) {
    return CardanoAddress.fromPaymentCredentials(
      paymentCredentials: newCredentials,
      stakeCredentials: stakeCredentialsBytes,
      networkId: networkId,
    );
  }
}

// [vending-machine] [2022-09-23 17:52:11] {"unsigned_tx":"","addresses_for_signing":["addr1q8k5nkddh5r9jg5shxskqv3ht44hn4xlwcx26rvme224tlzpn8mxk9kwn66cf8kev3el4nsztvhfhj7lrc6j44pk9xqsafxu96"]}
void main() async {
  debugAssertEnabled = true;

  // use those to reverse engineer cancelxq order
  // final minswapSubmitOrder = "84a60081825820b6e5f6eedabe5d5d3a20c68a16b2ad3c9ddf3d5f5fdd49403779187d365db7da02018283583911a65ca58a4e9c755fa830173d2a5caed458ac0c73f97db7faae2e7e3b52563c5410bff6a0d43ccebb7c37e1f69f5eb260552521adff33b9c21a008943dc5820cee864d5509f3e26489b8295a7eb9a19c0947428b459652217ef57956a669baa82583901ed49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fc4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad43629811a0af98e3a021a0002d141031a05db9eb0075820f1ff69ee39c1773d81414326ebe36a35ad2341d58e63e7f49fd3ae3df28791ec0b5820574ee569d6ac99001f2db7b442442e2b0ad42bbc991bd0b8cb8d5986832c2e65a20081825820dd5fba0222e5a11fd1979c4cc7a1ee88ff7a6c0ead5cb62d008a72dd709afae15840990583e7c2422199e4aeeb44eaa8cd1a03bd5774322df92e58e3aa726179a97577b076df5fe411f7b8efea67ee8be2dbe9766e7b15bf6f56319f0777e1c61d04049fd8799fd8799fd8799f581ced49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fcffd8799fd8799fd8799f581c4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad4362981ffffffffd8799fd8799f581ced49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fcffd8799fd8799fd8799f581c4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad4362981ffffffffd87a80d8799fd8799f581c29d222ce763455e3d7a09a665ce554f00ac89d2e99a1a83d267170c6434d494eff1a03fb2a80ff1a001e741c1a001e8480fffff5a11902a2a1636d736781781d4d696e737761703a2073776170206f7264657220766961205645535052";
  // final minswapCancelOrder = "84aa0081825820471e33432b8c6e5820e53618154ba23a2b5c094e1935ddfda9b8751aad3dfc4600018182583901ed49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fc4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad43629811a00862885021a00031b57031a05dbac62075820039c21bb80e729f444f6f5ab66b7e6d4c1deca6ece1cafe940209783bba2a32d0b582073542d38263fb89753b0e4da0df046da94175f2165b40861b609859d74a49c150d818258205938fa6313b485a1a0b7492e2d61336141ea7a7ad4dad041955d52c05d923ad4000e81581ced49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fc1082583901ed49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fc4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad43629811a004c4b40111a004c4b40a3038159014f59014c01000032323232323232322223232325333009300e30070021323233533300b3370e9000180480109118011bae30100031225001232533300d3300e22533301300114a02a66601e66ebcc04800400c5288980118070009bac3010300c300c300c300c300c300c300c007149858dd48008b18060009baa300c300b3754601860166ea80184ccccc0288894ccc04000440084c8c94ccc038cd4ccc038c04cc030008488c008dd718098018912800919b8f0014891ce1317b152faac13426e6a83e06ff88a4d62cce3c1634ab0a5ec133090014a0266008444a00226600a446004602600a601a00626600a008601a006601e0026ea8c03cc038dd5180798071baa300f300b300e3754601e00244a0026eb0c03000c92616300a001375400660106ea8c024c020dd5000aab9d5744ae688c8c0088cc0080080048c0088cc00800800555cf2ba15573e6e1d200201049fd8799fd8799fd8799f581ced49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fcffd8799fd8799fd8799f581c4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad4362981ffffffffd8799fd8799f581ced49d9adbd06592290b9a16032375d6b79d4df760cad0d9bca9555fcffd8799fd8799fd8799f581c4199f66b16ce9eb5849ed96473face025b2e9bcbdf1e352ad4362981ffffffffd87a80d8799fd8799f581c29d222ce763455e3d7a09a665ce554f00ac89d2e99a1a83d267170c6434d494eff1a03fb2a80ff1a001e741c1a001e8480ffff0581840000d87a80821950131a007a6dacf5a11902a2a1636d736781754d696e737761703a2043616e63656c204f72646572";

  final String raw_tx = """
  84a80081825820ae759a220133178ade7028e42c3b73bff6650cf9efd7f9420eb9352c7fa5f3f500018282583901ffebcc9e31749eb5803e396202d84e3b436ec362463b2fd70fb4c8819086fc9117b2dadb43da1f922c46039a47d51bff09433dcdd18f1cce1a000f424082583901966657c9a6703d2cc03df8eae46544d570b079646721c5b6818b59fa83b21d746e406619336e098e401b4062d2710ee5e52537a8170324d41a025b9165021a00160aa9031a0681f1eb0b5820d5af87857e272b38a0a8738b7c43dfb68a61e90b47f064f5268846625a53565a0d81825820740bd0a521eb2849e1cb22ffe2a0869f47cd8236fdfa7322aa78b665763f86a0000e83581c966657c9a6703d2cc03df8eae46544d570b079646721c5b6818b59fa581c966657c9a6703d2cc03df8eae46544d570b079646721c5b6818b59fa581c83b21d746e406619336e098e401b4062d2710ee5e52537a8170324d41281825820fc9e99fd12a13a137725da61e57a410e36747d513b965993d92c32c67df9259a02a200838258203e5e0a1fb6eb9f9f525ac5aa8869e2b34566ca0b2c0f74821c8a9efe8e44368b584016b005c481054a46922f412d49b299d4ff5a0069aba82a531722ece460c4eee161e8523b4f0a47d0c692e727d5cd938d0dac4d44cebf0078fcd8e47fd4db610a82582057e7f64ed48fcfa8a0113300be4d8fce46b7103dbada5de1b56702cedd99279e5840ca46f1763f3ca94c193fe408fd9ed13a5820cc3461864862755357150b36db40aa06d17a87e9544596e00edd588042049f7d51822fe3548519163dfda35fbe0f825820f4f5835e6f2fc1551153d0d1a4432a728966805da9ddd7c666b661aad9c827175840b0178716843816a46e25e25f3d08297bb89600e73ddfd3a60aa29142b4a5c4a4f8177f7d9623854cfd7d734c43355e36c2710c4bbd2af607dadab93df22acb040581840000d8799f00000001ff821a009896801b0000000218711a00f5f6
  """
      .trim()
      .split("\n")
      .map((e) => e.replaceAll("flutter: â•‘ ", ""))
      .join();

  final txx = CardanoTransaction.deserializeFromHex(raw_tx);
  final l = await txx.toLedgerSigningRequest(
      accountIndex: 0,
      inputUtxoToAddress: {},
      maxDeriveAddressCount: 10,
      networkId: txx.body.networkId ?? NetworkId.mainnet,
      xPubBech32:
          "xpub1zaqfhav0tyx4txtnlkkmt7k4y0equ87ankq7lxtspeddfqsflpf5pt3ws3hcsm5tzvwca3ra2te8n8u3cs3ltwwc0774rvfxt4v820cp6f6vy");

  print(txx.toJson(prettyPrint: true));

  print(l);
}
